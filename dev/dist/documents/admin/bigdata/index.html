<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta http-equiv="x-ua-compatible" content="IE=edge">
<meta charset="utf-8">
<meta name="description" content="">
<meta name="viewport" content="width=device-width">
<meta name="description" content="DeployR - Simple R analytics integration for application developers.">
<meta name="keywords" content="R,Simple,DeployR,Java,JavaScript,.NET,Statistics,Big Data">
<meta name="author" content="Microsoft Corporation">
<meta name="google-site-verification" content="BQWjliQil8coeYFDfd-nee7j5GDJ0p-6lU4abeJiAZU">

<!--<time itemprop="buildDate" datetime="Wednesday, March 16th, 2016, 9:47:06 AM PDT"></time>-->

<title>
  DeployR &middot; Managing External Directories for Big Data
</title>

<!-- Favicons -->
<link rel="shortcut icon" href="../../../assets/img/favicon.png" type="image/png" >
<link rel="icon" href="../../../assets/img/favicon.png" type="image/png">

<!-- Bootstrap styles -->
<link rel="stylesheet" href="../../../assets/css/vendor/bootstrap/bootstrap.min.css">

<!-- Documentation extras -->
<link href="../../../assets/css/github.css" rel="stylesheet">

<!-- Glyphicons -->
<link rel="stylesheet" href="../../../assets/css/vendor/glyphicons/glyphicons.min.css">
<link rel="stylesheet" href="../../../assets/css/vendor/glyphicons/filetypes.min.css">
<link rel="stylesheet" href="../../../assets/css/vendor/glyphicons/social.min.css">

<!-- Google Webfonts -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:400,700,600" rel="stylesheet" type="text/css">

<!-- LayerSlider styles -->
<link rel="stylesheet" href="../../../assets/css/vendor/layerslider/layerslider.min.css" type="text/css">

<!-- Grove Styles (switch for different color schemes, e.g. "styles-cleanblue.css") -->
<link rel="stylesheet" href="../../../assets/css/styles-blue.css" id="grove-styles">

<!-- Site Styles -->
<link href="../../../assets/css/site.css" rel="stylesheet">

<!--[if lt IE 9]>
  <link rel="stylesheet" href="../../../assets/css/ie8.css">        
  <script src="../../../assets/js/vendor/google/html5-3.6-respond-1.1.0.min.js"></script>
<![endif]-->

<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.min.js"></script>
<script>window.jQuery || document.write('<script src="../../../assets/js/vendor/jquery/jquery-1.9.1.min.js"><\/script>')</script>
<!-- jQuery with jQuery Easing, and jQuery Transit JS -->
     
<!-- LayerSlider from Kreatura Media with Transitions -->
<script src="../../../assets/js/vendor/layerslider/greensock.js" type="text/javascript"></script>
<script src="../../../assets/js/vendor/layerslider/layerslider.transitions.js" type="text/javascript"></script>
<script src="../../../assets/js/vendor/layerslider/layerslider.kreaturamedia.jquery.js" type="text/javascript"></script>

<!-- Grove Layerslider initiation script -->
<script src="../../../assets/js/grove-slider.js" type="text/javascript"></script>

<!-- GA for DeployR-site -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6984166-13', 'auto');
  ga('send', 'pageview');
</script>
  </head>
  <body data-spy="scroll" data-target="#sidenav">
    <a class="sr-only" href="#content">Skip to main content</a>

    <!-- master nav -->
    <header>
   <nav class="navbar navbar-default grove-navbar" role="navigation">
      <div class="container">
         <div class="navbar-header">
            <a href="#" class="grove-toggle" data-toggle="collapse" data-target=".grove-nav">   
            <i class="glyphicons show_lines"></i>  
            </a>
            <a href="/" class="navbar-brand">
            <img src="../../../assets/img/rLogo.png" alt="DeployR"> DeployR
            </a>
         </div>
         <div class="collapse navbar-collapse grove-nav">
            <ul class="nav navbar-nav">
               <li class="dropdown">
                  <a href="#" data-toggle="dropdown">Data Scientists <b class="caret"></b></a>            
                  <ul class="dropdown-menu">
                     <li><a href="/documents/getting-started/data-scientist">Getting Started</a></li>
                <!--<li><a href="#">Learn-by-Example Tutorial</a></li>-->
                     <li><a href="/documents/dev/scientist-portable-code">Portable R Code Guide</a></li>
                     <li><a href="/documents/help/repo-man">Repository Manager Help</a></li>
                     <li><a href="/documents/getting-started/data-scientist#resources">More...</a></li>
                  </ul>
               </li>
               <li class="dropdown">
                  <a href="#" data-toggle="dropdown">Application Developers <b class="caret"></b></a>            
                  <ul class="dropdown-menu">
                     <li><a href="/documents/getting-started/application-developer">Getting Started</a></li>
                     <!--<li><a href="#">Learn-by-Example Tutorial</a></li>-->
                     <li><a href="/documents/dev/rbroker">RBroker Framework Tutorial</a></li>
                     <li><a href="/documents/dev/clientlib">Client Library Tutorial</a></li>
                     <li><a href="/documents/dev/api-doc">API Reference Guide</a></li>
                     <li><a href="/docanddown">Library Downloads</a></li>
                     <li><a href="/documents/getting-started/application-developer/#resources">More...</a></li>
                  </ul>
               </li>
               <li class="dropdown">
                  <a href="#" data-toggle="dropdown">Administrators <b class="caret"></b></a>            
                  <ul class="dropdown-menu">
                     <li><a href="/documents/getting-started/administrator">Getting Started</a></li>
                     <li><a href="/documents/admin/install">Installation & Configuration</a></li>
                     <li><a href="/documents/admin/security">Security</a></li>
                     <li><a href="/documents/admin/r-package-mgmt">R Package Management</a></li>
                     <li><a href="/documents/help/admin-console">Administration Console Help</a></li>
                     <li><a href="/documents/admin/troubleshoot">Troubleshooting</a></li>
                     <li><a href="/documents/getting-started/administrator/#resources">More...</a></li>
                  </ul>
               </li>
               <li class="dropdown">
                  <a href="#" data-toggle="dropdown">
                  Community <b class="caret"></b>
                  </a>            
                  <ul class="dropdown-menu">
                     <li><a href="http://go.microsoft.com/fwlink/?LinkID=708535" target="_blank">Forum / Discussion Group</a></li>
                     <li><a href="/faq">FAQs</a></li>
                  </ul>
               </li>
              <li class="dropdown">
                  <a href="#" data-toggle="dropdown">Download<b class="caret"></b></a>            
                  <ul class="dropdown-menu pull-right">   
                    <li><a href="/download">Download DeployR</a></li>
                    <li><a href="/documents/admin/install">Install DeployR</a></li>
                    <li><a href="/releases/">Release History</a></li>
                  </ul>
            </ul>
         </div>
         <!-- /.navbar-collapse -->
      </div>
   </nav>
</header>


    <!-- page title -->
    <div class="widewrapper pagetitle strong-highlight">
   <div class="container">
      <h1>Managing External Directories for Big Data <small></small></h1>
      <span class="product-version">
         Version 8.1.0
         
      </span>
   </div>
</div>
  
    <div class="widewrapper sf-wrapper">
      <div class="container content" role="main">
        <div>
          
<div class="row"><div class="col-md-3" id="sidenav"><div class="bs-sidebar hidden-print hidden-xs hidden-sm" role="complementary"><ul class="nav bs-sidenav"><li class="active"><a href="#externaldir">Introduction</a><ul class="nav"></ul></li><li><a href="#configuration">Setting up NFS Setup</a><ul class="nav"></ul></li><li><a href="#structure">External Directory Structure</a><ul class="nav"></ul></li><li><a href="#addfiles">Adding Files to External Directories</a><ul class="nav"></ul></li></ul></div></div><div class="col-md-9" role="main"><div class="container-fluid content doc-content"><h1 id="externaldir">Introduction</h1>

<p>Whenever the data files with which your users need to work are too big to be copied from the Web or copied from their local machines to the server, those files can be stored in &#39;big data&#39; external directories on the DeployR main server. It is your responsibility as the DeployR administrator to configure and manage these &#39;big data&#39; external directories and the data files within them.</p>
<p>Once you put the big data files in the external directories, data scientists can use <a href="#addfiles">the <code>deployrExternal</code> function</a> from the <code>deployrUtils</code> package in their R code to reference these files in such a way that they can be found whether the R code is run locally or on the DeployR server.  Additionally, these external directories can also be referenced in R code without the overhead of replicating the big data itself for each individual project. </p>
<h1 id="configuration">Setting up NFS Setup</h1>

<div class="alert alert-warning"><strong>Important! </strong>
NFS configuration for external directories is required only if your DeployR environment has multiple grid nodes. DeployR Open administrators can skip this step.
</div>

<p>To benefit from external directory support in a multi-grid node DeployR environment, you (the administrator) must install and configure a Network File System (NFS) shared directory on the DeployR main server as well as any grid node from which they want to access to this big data files. </p>
<h2 id="configure-nfs-on-windows">Configure NFS on Windows</h2>
<ol>
<li><p>NFS mount the <code>&lt;INSTALL_DIR&gt;/deployr/external</code> directory on both the DeployR main server and each grid node.<br><code>&lt;INSTALL_DIR&gt;</code> is the full path to directory into which you installed DeployR, which is <code>C:\Program Files\Microsoft\DeployR\8.1\</code> by default.</p>
</li>
<li><p>Open the Windows firewall ports as described in the Windows NFS documentation for your platform.</p>
</li>
</ol>
<h2 id="configure-nfs-on-linux">Configure NFS on Linux</h2>
<div class="alert alert-warning"><strong>Important! </strong> 
If you do not have access to the Internet, you’ll have to copy the install files to this machine using another method.
</div>

<ol>
<li><p>Log into the operating system as <code>root</code>. </p>
</li>
<li><p>Install NFS. 
</p><ul class="code-tabs nav nav-tabs"><li class="active"><a href="#tab-EJMim6Ozpl-0" data-toggle="tab" data-type="">Redhat</a></li><li class=""><a href="#tab-EJMim6Ozpl-1" data-toggle="tab" data-type="">SLES</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-EJMim6Ozpl-0"><p></p>
<pre><code>yum install -y nfs-utils nfs-utils-lib</code></pre>
<p></p></div><div class="tab-pane" id="tab-EJMim6Ozpl-1"><p></p>
<pre><code>zypper install -y nfs-kernel-server</code></pre>
<p></p></div></div><p></p>
</li>
<li><p>Open the file <code>/etc/sysconfig/nfs</code> and add these lines to the end of the file:</p>
<pre><code>RQUOTAD_PORT=10000
LOCKD_TCPPORT=10001
LOCKD_UDPPORT=10002
MOUNTD_PORT=10003
STATD_PORT=10004
STATD_OUTGOING_PORT=10005
RDMA_PORT=10006</code></pre>
</li>
<li><p>In IPTABLES, open the following ports for NFS for external directory support:</p>
<ul>
<li><code>111</code>  </li>
<li><code>2049</code>   </li>
<li><code>10000:10006</code></li>
</ul>
</li>
<li><p>Restart IPTABLES.</p>
<pre><code>service iptables restart</code></pre>
</li>
<li><p>Set up the automatic start of NFS and <code>portmap/rpcbind</code> at boot time. At the prompt, type:
</p><ul class="code-tabs nav nav-tabs"><li class="active"><a href="#tab-Nkmi7adMag-0" data-toggle="tab" data-type="">Redhat&nbsp;5</a></li><li class=""><a href="#tab-Nkmi7adMag-1" data-toggle="tab" data-type="">Redhat&nbsp;6</a></li><li class=""><a href="#tab-Nkmi7adMag-2" data-toggle="tab" data-type="">SLES</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-Nkmi7adMag-0"><p>
For both the main server and any grid machines on Redhat 5, type:</p>
<pre><code>/sbin/chkconfig nfs on 
/etc/init.d/portmap start 
/etc/init.d/nfs start</code></pre>
<p></p></div><div class="tab-pane" id="tab-Nkmi7adMag-1"><p>
For both the main server and any grid machines on Redhat 6, type:</p>
<pre><code>/sbin/chkconfig nfs on 
/etc/init.d/rpcbind start 
/etc/init.d/nfs start</code></pre>
<p></p></div><div class="tab-pane" id="tab-Nkmi7adMag-2"><p>
For the main server on SLES, type the following at the prompt:</p>
<pre><code>/sbin/chkconfig nfsserver on 
/etc/init.d/rpcbind start 
/etc/init.d/nfsserver start</code></pre>
<p>For a grid machine on SLES, type the following at the prompt:</p>
<pre><code>/sbin/chkconfig nfs on 
/etc/init.d/rpcbind start 
/etc/init.d/nfs start</code></pre>
<p></p></div></div><p></p>
</li>
<li><p>To create a new NFS directory share, run the following commands.  To update an existing NFS share, see the next step instead.</p>
<ul>
<li><p>On the DeployR main server: </p>
<ol>
<li><p>Add a line to the file <code>/etc/exports</code>. </p>
<pre><code>/home/deployr-user/deployr/8.1.0/deployr/external/data *(rw,sync,insecure,all_squash,anonuid=48,anongid=48)</code></pre>
</li>
<li><p>Broadcast the new directory. At the prompt, type:</p>
<pre><code>exportfs -r</code></pre>
</li>
</ol>
</li>
<li><p>On the DeployR grid node machine:</p>
<ol>
<li>Add a line to the end of the fstab file, where <code>&lt;DeployR_server_ip&gt;</code> is the IP or hostname of the machine on which you installed DeployR, <pre><code>&lt;deployr_server_ip&gt;:/home/deploy-user/deploy-install/deployr/external/data /home/deploy-user/deploy-install/deployr/external/data nfs rw 0 0&quot;</code></pre>
</li>
<li>Attempt to mount the contents of the file and verify the NFS points to the correct address. At the prompt, type:<pre><code>mount -a
df -k</code></pre>
</li>
</ol>
</li>
</ul>
</li>
<li><p>To use an existing NFS directory share, do the following for the main server and each grid node. </p>
<ol>
<li>Add the following line to <code>/etc/fstab</code>, where <code>&lt;nfs_share_hostname&gt;</code> and <code>&lt;nfs_share_directory&gt;</code> is the IP or hostname and directory of the machine where the NFS share site exists:<pre><code>&lt;nfs_share_hostname&gt;:/&lt;nfs_share_directory&gt;   /deployr/external/data  nfs  rw   0   0</code></pre>
</li>
<li>Try to mount the contents of the file and verify the NFS points to the correct address. At the prompt, type:<pre><code>mount -a
df -k</code></pre>
</li>
</ol>
</li>
</ol>
<h1 id="structure">External Directory Structure</h1>

<p>While it suffices for users to store their local copy of the data in the current working directory of their R session, the external directory structure in the DeployR server environment is not transparent to the users. For this reason, you need to <a href="#addfiles">put the files into the external directories for them</a>.</p>
<p>The external directory structure is really a tree of public and private directories hanging off a common base directory managed by you, the DeployR administrator. </p>
<p>  </p><ul class="code-tabs nav nav-tabs"><li class="active"><a href="#tab-V14sXpdfTx-0" data-toggle="tab" data-type="">Linux</a></li><li class=""><a href="#tab-V14sXpdfTx-1" data-toggle="tab" data-type="">Windows</a></li><li class=""><a href="#tab-V14sXpdfTx-2" data-toggle="tab" data-type="">Mac OS X</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-V14sXpdfTx-0"><p></p>
<p>  For example, if the base directory is <code>/home/deployr-user/deployr/8.1.0/deployr/external/data</code>, then the base external directory structure might look:</p>
<ul>
<li><code>/home/deployr-user/deployr/8.1.0/deployr/external/data/public</code></li>
<li><code>/home/deployr-user/deployr/8.1.0/deployr/external/data/testuser</code></li>
<li><code>/home/deployr-user/deployr/8.1.0/deployr/external/data/user1</code></li>
<li><p><code>/home/deployr-user/deployr/8.1.0/deployr/external/data/{private_user_dir}</code></p>
<p></p></div><div class="tab-pane" id="tab-V14sXpdfTx-1"><p></p>
<p>For example, if the base directory on the main server is <code>C:/Program Files/Microsoft/DeployR/8.1/deployr/external/data/</code>, then the base external directory structure might look:</p>
</li>
<li><code>C:/Program Files/Microsoft/DeployR/8.1/deployr/external/data/public</code></li>
<li><code>C:/Program Files/Microsoft/DeployR/8.1/deployr/external/data/testuser</code></li>
<li><code>C:/Program Files/Microsoft/DeployR/8.1/deployr/external/data/user1</code></li>
<li><p><code>C:/Program Files/Microsoft/DeployR/8.1/deployr/external/data/{private_user_dir}</code></p>
<p></p></div><div class="tab-pane" id="tab-V14sXpdfTx-2"><p></p>
<p>For example, if the base directory is <code>/Users/deployr-user/deployr/8.1.0/deployr/external/data</code>, then the base external directory structure might look:</p>
</li>
<li><code>/Users/deployr-user/deployr/8.1.0/deployr/external/data/public</code></li>
<li><code>/Users/deployr-user/deployr/8.1.0/deployr/external/data/testuser</code></li>
<li><code>/Users/deployr-user/deployr/8.1.0/deployr/external/data/user1</code></li>
<li><code>/Users/deployr-user/deployr/8.1.0/deployr/external/data/{private_user_dir}</code></li>
</ul>
<p>  </p></div></div><p></p>
<p>Two directories are automatically created by the server the first time the corresponding user logs into the system. The first directory is called <code>/public</code> and contains the files that can be read by any authenticated users on the server. The second directory is the user’s private directory. Each private external directory can be found at <code>&lt;DeployR_Install_Dir&gt;/external/data/{deployr_username}</code>. Files in each private directory are available only to that authenticated user during a live session.  The administrator can also manually create these subdirectories in advance. The names of the directories are case-sensitive.</p>
<p>For example, the user <code>testuser</code> will have access to the files under:</p>
<ul>
<li>The private external directory, <code>&lt;DeployR_Install_Dir&gt;/external/data/testuser</code></li>
<li>The <code>/public</code> directory, <code>&lt;DeployR_Install_Dir&gt;/external/data/public</code>.</li>
</ul>
<p>It is up to the administrator to inform each user of which files are available in the <code>/public</code> directory and which files are in their private directory. </p>
<h1 id="addfiles">Adding Files to External Directories</h1>

<p>A file can be added to the external directories in one of two ways. </p>
<ol>
<li>You can place the file, on the user&#39;s behalf, into his or her private external directories or into the <code>/public</code> external directory so that it can be access when running R code. </li>
<li>A user can execute R code that will write a file directly into his or her private external directory.</li>
</ol>
<p>Ultimately, the administrator is responsible for moving and managing files in the external directories as well as informing users that the files exist and their whereabouts. </p>
<p>To reference one of these files in the code, a user must declare and, therefore, know if the given file is stored in the <code>/public</code> external subdirectory or the user&#39;s private subdirectory. This declaration is done using the <code>deployrExternal</code> function in the <code>deployrUtils</code> package. This function provides read and write access to big data files in a portable way whether the R code is run locally or in the remote DeployR server environment. For more information, point your users to the <a href="/documents/dev/scientist-portable-code/#fileaccessport">Writing Portable R Code</a> guide and the package help for this function (<code>??deployrUtils::deployrExternal</code>).</p>
<div class="well well-sm"><strong>Note: </strong> Currently there is no user interface to display the names of the files in this directory. Additionally, due to the potentially large size of the data, we do not expose any API or other facility for moving data into the external directories.</div></div></div></div>
        </div>    
      </div>
      <div class="push"></div>
    </div>

    <!-- Footer
    ================================================== -->

    <footer class="widewrapper footer bs-footer" role="contentinfo">
  <div class="container">
    <div class="row footer">
      <div class="col-sm-3">
        <h4>Get Started</h4>
        <ul class="grove-list">
          <li><a href="/documents/getting-started/about">About DeployR</a></li>
          <li><a href="/download">Download DeployR</a></li>
          <li><a href="/documents/admin/install">Install DeployR</a></li>
          <li><a href="/documents/admin/troubleshoot">Troubleshooting & Diagnostics</a></li>
        </ul>
      </div>
      <div class="col-sm-3">
        <h4>Develop</h4>
        <ul class="grove-list">
          <li><a href="/dev">Get Client Developer Tools</a></li>
            <li><a href="/docanddown#rbroker">RBroker Framework</a></li>
          <li><a href="/docanddown#clientlib">API Client Libraries</a></li>
          <li><a target="_blank" href="/documents/dev/api-doc">API Reference Guide</a></li>
          <li><a target="_blank" href="/documents/help/repo-man">Repository Manager</a></li>
         <!-- <li><a href="/docanddown#integration">3rd Party Tool Integration</a></li>-->
        </ul>
      </div>
      <div class="col-sm-3">
        <h4>Manage</h4>
          <ul class="grove-list">
            <li><a target="_blank" href="/documents/help/admin-console">Administration Console</a></li>
            <li><a href="/documents/admin/security">Security Guide</a></li>
            <li><a href="/documents/admin/throughput">Scale & Throughput</a></li>
            <li><a href="/documents/admin/highavail">High Availability</a></li>
            <li><a href="/documents/admin/bigdata">Managing Big Data</a></li>
          </ul>
      </div>
      <div class="col-sm-3">
        <h4>DeployR 8.1.0</h4>
          <ul class="grove-list">
            <li><a href="/license">License Information</a></li>
      	    <li><a href="/documents/admin/whats-new/">What's New in 8.1.0</a></li>
	          <li><a href="http://go.microsoft.com/fwlink/?LinkID=708535" target="_blank">Join the DeployR Forum</a></li>
	          <li><a href="/releases/">Release Archives</a></li>
          </ul>
         <div><small> &copy; 2015 Microsoft Corporation</small></div>
      </div>    
    </div>
  </div>          
</footer> 

    
    <!-- JS and analytics only. -->
    <!-- Bootstrap core JavaScript
================================================== -->
<script src="../../../assets/js/vendor/bootstrap/bootstrap.min.js"></script>
<script src="../../../assets/js/vendor/modernizr/modernizr.js"></script>
<script src="../../../assets/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Google Analytics (click event)
================================================== -->

<script>
   $('.ga-track').on('click', function() {
      try { 
        var label = $(this).data('ga') || $(this).text();
        ga('send', 'event', 'button', 'click', label);
      } catch (err) {}
   });
</script>

<!-- TOC
================================================= -->
<script>
  // back to top
  setTimeout(function () {
     var $sideBar = $('.bs-sidebar');
     if (!$sideBar) { return; }
     $sideBar.affix({
     offset: {
     top: function () {
        var offsetTop = $sideBar.offset().top
        var sideBarMargin = parseInt($sideBar.children(0).css('margin-top'), 10)
        var navOuterHeight = $('.bs-docs-nav').height()
        return (this.top = offsetTop - navOuterHeight - sideBarMargin)
      }
      , bottom: function () {
        return (this.bottom = $('.bs-footer').outerHeight(true))
      }
    }
    })
  }, 100)
</script>

<script>
  $('.tab-content div').each(function( index ) {
    if(index === 0) { $(this).addClass('active'); }
  });

  $('.code-tabs a').click(function (e) {
  });

</script>

     
  </body>
</html>